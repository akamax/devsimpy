# -*- coding: Latin-1 -*-

import sys

# TODO replace this with your PyPDEVS src folder
sys.path.append("/home/yentl/UA/DEVS/src")

from DEVS import AtomicDEVS, CoupledDEVS
from simulator import Simulator
from infinity import INFINITY

class Generator(AtomicDEVS):
    def __init__(self, name):
        AtomicDEVS.__init__(self, name)
        self.state = True
        self.sigma = 0
        self.outport = self.addOutPort("outport")

    def timeAdvance(self):
        return self.sigma

    def outputFnc(self):
        # Our message is simply the integer 5, though this could be anything
        return {self.outport: [5]}

    def intTransition(self):
        self.sigma = 1
        return self.state

class Queue(AtomicDEVS):
  def __init__(self):
      AtomicDEVS.__init__(self, "Queue")
      self.state = None
      self.processing_time = 1.0
      self.inport = self.addInPort("input")
      self.outport = self.addOutPort("output")

  def timeAdvance(self):
      if self.state is None:
          return INFINITY
      else:
          return self.processing_time

  def outputFnc(self):
      return {self.outport: [self.state]}

  def intTransition(self):
      self.state = None
      return self.state

  def extTransition(self, inputs):
      self.state = inputs[self.inport][0]
      return self.state

class CoupledGenerator(CoupledDEVS):
    def __init__ (self):
        CoupledDEVS.__init__ (self ,"CoupledGenerator")
        self.generator = self.addSubModel(Generator("Generator"))
        self.inport = self.addInPort ("inport")
        self.outport = self.addOutPort ("outport")
        self.connectPorts (self.inport , self.generator.inport)
        self.connectPorts (self.generator.outport , self.outport)

class CQueue(CoupledDEVS):
    def __init__(self):
        CoupledDEVS.__init__(self, "DQueue")
        self.generator = self.addSubModel(CoupledGenerator())
        self.queue = self.addSubModel(Queue())
        self.connectPorts(self.generator.outport, self.queue.inport)
